(function(){"use strict";var e={1834:function(e,t,s){var a=s(5130),o=s(2261),i=s(6768),n=s(144),l=s(4232),r=(s(4114),s(8111),s(2489),s(1701),s(7588),s(4373));const c=(()=>{let e="",t="",s=!1,a="";const o={localServerBaseURL:"/api",remoteServerURL:"http://47.122.135.160:3000",cozeFileUploadURL:"https://api.coze.cn/v1/files/upload",cozeChatURL:"https://api.coze.cn/v3/chat",botId:"7511906415587016723",userId:"1024",pollInterval:2e3,maxPollAttempts:90,mobileCheckRegex:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i},i=e=>{Object.assign(o,e)},n=async(e,t)=>{const s=new FormData;s.append("file",e);const a=await r.A.post(o.cozeFileUploadURL,s,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}});return a.data.data.id},l=async(s,a)=>{const i={bot_id:o.botId,user_id:o.userId,stream:!1,auto_save_history:!0,additional_messages:[{role:"user",content:JSON.stringify([{type:"image",file_id:s}]),content_type:"object_string"}]},n=await r.A.post(o.cozeChatURL,i,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});return t=n.data.data.conversation_id,e=n.data.data.id,{conversationId:t,chatId:e}},c=async s=>{const a=`${o.cozeChatURL}/retrieve?chat_id=${e}&conversation_id=${t}`;let i="in_progress",n=0;while("in_progress"===i&&n<o.maxPollAttempts){await new Promise((e=>setTimeout(e,o.pollInterval)));try{const e=await r.A.get(a,{headers:{Authorization:`Bearer ${s}`}});if(i=e.data.data.status,n++,"completed"===i)return!0}catch(l){console.error("轮询请求失败:",l),n++}}throw new Error("轮询超时或识别未完成")},d=async s=>{const i=`${o.cozeChatURL}/message/list?chat_id=${e}&conversation_id=${t}`,n=await r.A.get(i,{headers:{Authorization:`Bearer ${s}`}});let l="";return console.log("1111111111111111111111"),console.log(n),n.data.data.forEach((e=>{"tool_response"===e.type&&(l+=e.content),"answer"===e.type&&(a+=e.content)})),l.replace(/null/g,"")},u=async(e,t)=>{try{s=!0,console.log("1"),console.log("2");const o=await n(e,t);console.log("3"),await l(o,t),console.log("4"),await c(t),console.log("5");const i=await d(t);return console.log("6"),{success:!0,previewUrl:"",analysisResult:i,answer:a}}catch(o){return console.error("识别过程出错:",o),{success:!1,error:o.message||"图像识别失败"}}finally{s=!1}};return{identifyImage:u,setConfig:i,getStatus:()=>({isIdentifying:s})}})();var d=c;const u=(0,o.nY)("app",{state:()=>({points:100,parseCost:10,userId:"",showKeyModal:!1,secretKey:"",showKey:!1,imageUrl:null,result:"",formattedResult:"",isProcessing:!1,processingTime:0,showServiceModal:!1,showInsufficientModal:!1,formulaRendered:!1,token:"pat_8tA94A3g2TAoVwPdCJBZvfqrB5EExHQqp42uGvDKPdXyN2WGdadcd3wFy1th6LvB",workflow_id:"7514867340287197195",imgFile:null,errorMessage:"",isHistoryLoaded:!1,sampleResults:[" "," "," "],redeemedKeys:JSON.parse(localStorage.getItem("redeemedKeys"))||[],keyUsageHistory:[],history:(()=>{try{const e=localStorage.getItem("mathSolverHistory");return e&&"undefined"!==e&&"null"!==e?JSON.parse(e):[]}catch(e){return console.error("历史记录解析错误",e),[]}})(),showHistorySidebar:!1,activeHistory:null,taobaoLinks:{100:"https://taobao.com/item1",200:"https://taobao.com/item2",500:"https://taobao.com/item3",1e3:"https://taobao.com/item4"}}),actions:{initUserId(){let e=localStorage.getItem("user_id");e||(e="user_"+Math.random().toString(36).substring(2,12)+Date.now().toString(36),localStorage.setItem("user_id",e)),this.userId=e;const t=localStorage.getItem(`points_${e}`);null!==t?(this.points=parseInt(t,10),console.log(`从 localStorage 加载积分: ${this.points}`)):(this.points=100,localStorage.setItem(`points_${e}`,"100"),console.log(`初始化积分: ${this.points}`))},getDeviceId(){let e=localStorage.getItem("deviceId");return e||(e="device_"+crypto.randomUUID(),localStorage.setItem("deviceId",e)),e},async addPoints(e){try{this.points+=e,localStorage.setItem(`points_${this.userId}`,this.points.toString()),await fetch("https://your-api-domain.com/points",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({userId:this.userId,deviceId:this.getDeviceId(),points:this.points,operation:"add",amount:e})})}catch(t){console.error("积分同步失败:",t)}},consumePoints(e){return this.points>=e&&(this.points-=e,localStorage.setItem(`points_${this.userId}`,this.points.toString()),console.log(`积分消费: ${e}, 剩余积分: ${this.points}, 保存到 localStorage`),!0)},initMathJax(){window.MathJax&&(window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore"},startup:{typeset:!1},svg:{fontCache:"global"}})},processImageFile(e){if(!e.type.match("image.*"))return alert("请上传图片文件！"),!1;if(e.size>5242880)return alert("图片大小不能超过5MB！"),!1;const t=new FileReader;return t.onload=e=>{this.imageUrl=e.target.result},t.readAsDataURL(e),this.imgFile=e,this.isHistoryLoaded=!1,!0},async parseImage(){if(console.log("00000011111111----1"),!this.imgFile)return void(this.errorMessage="请先上传有效的图片文件");console.log("00000011111111----2"),console.log("000000111111111"),this.isProcessing=!0,this.result="",this.formattedResult="",this.formulaRendered=!1,this.errorMessage="",this.processingTime=5;const e=setInterval((()=>{this.processingTime--,this.processingTime<=0&&clearInterval(e)}),1e3);try{const e=await d.identifyImage(this.imgFile,this.token);if(e.success)try{const t=JSON.parse(e.analysisResult);if(!t.output||0===t.output.length)return this.formattedResult='\n                        <div class="error-prompt">\n                            \x3c!--<div class="error-icon">\n                                <i class="fas fa-exclamation-triangle"></i>\n                            </div>--\x3e\n                            <div class="error-content">\n                               <i class="fas fa-exclamation-triangle"></i> 很遗憾，暂时未能识别出图片中的习题信息，无法为你提供答案与解析。你可以检查图片是否清晰、完整，以便我更好地为你解答。 \n                            </div>\n                        </div>\n                    ',void(this.result=e.answer);this.formattedResult=t.output.map(((e,t)=>{const s={answered:e.answered?"#52c41a":"#ff4d4f",correct:e.isCorrect?"#52c41a":"#ff4d4f",neutral:"#94a3b8"};console.log(t);const a=e.answered?`color: ${e.isCorrect?s.correct:s.answered}; font-weight: 600;`:`color: ${s.neutral};`,o=e.options?Object.entries(e.options).map((([e,t])=>`\n<div class="option-item">\n    <span class="option-key">${e}.</span>\n    <span class="option-value">${t}</span>\n</div>`)).join(""):"";return`\n<div class="exercise-card">\n    \x3c!-- 头部：题号+题干 --\x3e\n    <div class="exercise-header">\n        <div class="question-title">${e.question}</div>\n    </div>\n    \n    \x3c!-- 选项区域 --\x3e\n    ${o?`\n    <div class="options-container">\n        ${o}\n    </div>`:""}\n    \n    \x3c!-- 答案区域 --\x3e\n    <div class="answer-container">\n        <div class="answer-label">参考答案：</div>\n        <div class="answer-content" style="${a}">\n            ${e.answer||"无答案信息"}\n        </div>\n    </div>\n    \n    \x3c!-- 状态区域 --\x3e\n    <div class="status-container">\n        <div class="status-item ${e.answered?"status-correct":"status-incorrect"}">\n            <span class="status-label">作答状态：</span>\n            <span class="status-value">\n                ${e.answered?"✓ 已作答":"✗ 未作答"}\n            </span>\n        </div>\n        \n        <div class="status-item ${e.isCorrect?"status-correct":"status-incorrect"}">\n            <span class="status-label">结果判定：</span>\n            <span class="status-value">\n                ${e.isCorrect?"✓ 正确":"✗ 错误"}\n            </span>\n        </div>\n    </div>\n    \n    \x3c!-- 解析区域 --\x3e\n    <div class="analysis-container">\n        <div class="analysis-label">题目解析</div>\n        <div class="analysis-content">${e.analysis||"暂无解析内容"}</div>\n    </div>\n</div>\n`})).join(""),this.result=t,await this.renderMathJax()}catch(t){console.error("JSON解析失败:",t),this.handleParseError("结果解析错误")}else{console.error("识别失败:",e.error),this.errorMessage=e.error||"图片识别失败，请重试";const t=Math.floor(Math.random()*this.sampleResults.length);this.result=this.sampleResults[t],this.formattedResult=this.result.replace(/\n/g,"<br>")}}catch(s){console.error("解析过程中发生错误:",s),this.errorMessage=`解析失败: ${s.message||"未知错误"}`;const e=Math.floor(Math.random()*this.sampleResults.length);this.result=this.sampleResults[e],this.formattedResult=this.result.replace(/\n/g,"<br>")}finally{this.isProcessing=!1,clearInterval(e)}},async renderMathJax(){if(await(0,i.dY)(),window.MathJax)try{MathJax.typesetClear(),await MathJax.typesetPromise(),this.formulaRendered=!0}catch(e){console.error("MathJax渲染错误:",e),this.formulaRendered=!1,this.errorMessage="公式渲染失败，但内容已显示"}},handleParseError(e){this.errorMessage=e,this.formattedResult=`\n        <div style="color: #f5222d; padding: 16px; background: #fff2f0; border: 1px solid #ffccc7;">\n            ${e}，已显示示例结果\n        </div>\n    `+this.sampleResults.join("<br>"),this.renderMathJax()},saveKey(){this.secretKey?(localStorage.setItem("mathAppSecretKey",this.secretKey),alert("秘钥已保存"),this.showKeyModal=!1):alert("请输入秘钥")},copyWechat(){navigator.clipboard.writeText("MathSolver_Service").then((()=>{alert("微信客服账号已复制到剪贴板")})).catch((e=>{console.error("复制失败:",e),alert("复制失败，请手动复制")}))},openTaobao(){window.open("https://www.taobao.com","_blank")},buyPoints(e){const t=this.taobaoLinks[e]||"https://www.taobao.com";window.open(t,"_blank")},async validateKey(e){try{const t=await fetch("https://your-api-domain.com/redeem",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({key:e,userId:this.userId,deviceId:this.getDeviceId()})}),s=await t.json();return s.success?{valid:!0,points:s.points}:{valid:!1,error:s.error||"兑换失败"}}catch(t){return console.error("秘钥验证失败:",t),{valid:!1,error:"网络错误，请稍后重试"}}},async validateKeyNew(e){try{const a=await fetch("https://api.coze.cn/v1/workflow/run",{method:"POST",headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"},body:JSON.stringify({workflow_id:this.workflow_id,parameters:{input:e}})});if(console.log("...............hhhhhh...................."),console.log(a),console.log(".....................gggggggg........."),!a.ok)throw new Error(`API request failed with status ${a.status}`);const o=await a.json();console.log("API response:",o);var t={};try{console.log("data.data:::"+o.data);const e=JSON.parse(o.data);console.log("data.data.output:::"+e),console.log("output::"+e.output),e.output.length>0?(t.valid=!0,t.points=parseFloat(e.output[0].key_points)):t.valid=!1,console.log("data.data.output.length:::"+e.output.length)}catch(s){console.log(s)}return console.log("currentObj:",t),t}catch(a){throw console.error("API调用失败:",a),a}},async addToHistory(e){e.imageUrl&&e.imageUrl.length>5e5&&(e.imageUrl=await this.compressImage(e.imageUrl)),Array.isArray(this.history)||(this.history=[]),this.history.length>=20&&this.history.pop(),e.imageUrl&&e.imageUrl.length>5e5&&(e.imageUrl=this.compressImage(e.imageUrl)),this.history.unshift(e),this.saveHistoryToLocalStorage()},compressImage(e){return new Promise((t=>{const s=new Image;s.onload=function(){const e=document.createElement("canvas"),a=e.getContext("2d"),o=800,i=600;let n=s.width,l=s.height;n>l?n>o&&(l*=o/n,n=o):l>i&&(n*=i/l,l=i),e.width=n,e.height=l,a.drawImage(s,0,0,n,l),t(e.toDataURL("image/jpeg",.7))},s.src=e}))},removeHistory(e){Array.isArray(this.history)||(this.history=[]),this.history=this.history.filter((t=>t.id!==e)),this.activeHistory===e&&(this.activeHistory=null),this.saveHistoryToLocalStorage()},loadHistory(e){this.activeHistory=e.id,this.imageUrl=e.imageUrl,this.result=e.result,this.formattedResult=e.formattedResult,this.formulaRendered=!0,this.isHistoryLoaded=!0},saveHistoryToLocalStorage(){localStorage.setItem("mathSolverHistory",JSON.stringify(this.history))},async loadKeyHistory(){try{const e=await fetch(`https://your-api-domain.com/key-history?userId=${this.userId}`);this.keyUsageHistory=await e.json()}catch(e){console.error("加载秘钥历史失败:",e)}},saveRedeemedKey(e){this.redeemedKeys.push({key:e,date:(new Date).toISOString(),points:this.lastRedeemedPoints}),localStorage.setItem("redeemedKeys",JSON.stringify(this.redeemedKeys))}},init(){this.initUserId(),this.initMathJax();const e=localStorage.getItem("mathAppSecretKey");e&&(this.secretKey=e)}});setInterval((async()=>{try{const e=await fetch(`https://your-api-domain.com/points?userId=${(void 0).userId}`),{points:t}=await e.json();t!==(void 0).points&&(console.warn("积分不一致，同步服务器状态"),(void 0).points=t,localStorage.setItem(`points_${(void 0).userId}`,t.toString()))}catch(e){console.error("定期同步失败:",e)}}),3e5);const p={class:"header"};function h(e,t){return(0,i.uX)(),(0,i.CE)("div",p,t[0]||(t[0]=[(0,i.Lk)("div",{class:"logo-container"},[(0,i.Lk)("div",{class:"logo"},[(0,i.Lk)("i",{class:"fas fa-calculator"})]),(0,i.Lk)("div",{class:"log-flag"},[(0,i.Lk)("h1",null," AI智能习题解析系统 "),(0,i.Lk)("p",null,"上传习题图片，获取详细解析与答案，支持复杂数学公式渲染")])],-1)]))}var v=s(1241);const m={},y=(0,v.A)(m,[["render",h],["__scopeId","data-v-425bd800"]]);var g=y;const k={class:"upload-container"},f={class:"upload-content"},L={key:0},b={class:"upload-text"},w={key:0,class:"camera-tip"},I={key:1,class:"preview-container"},R=["src"],C={class:"parse-btn-container"},S=["disabled"],_={class:"zoomed-container"},$=["src"],M={class:"image-controls"},x=["disabled"],K=["disabled"];var E={__name:"UploadSection",setup(e){(0,a.$9)((e=>({d3961c06:r.value})));const t=(0,n.KR)(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),s=u(),o=(0,n.KR)(!1),r=(0,n.KR)(1);(0,i.sV)((()=>{navigator.mediaDevices&&console.log("摄像头支持已启用")}));const c=()=>{o.value=!o.value,o.value&&(r.value=1)},d=()=>{r.value<3&&(r.value+=.1)},p=()=>{r.value>.5&&(r.value-=.1)},h=()=>{r.value=1};let v=null;const m=()=>{console.log("111111111111111111111111111"),console.log("233333333333333333333333333"),document.getElementById("fileInput").click()},y=e=>{v=e.target.files[0],s.imgFile=v,v&&s.processImageFile(v)},g=e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&s.processImageFile(t)};return(e,u)=>((0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",k,[u[11]||(u[11]=(0,i.Lk)("div",{class:"upload-header"},[(0,i.Lk)("i",{class:"fas fa-cloud-upload-alt"}),(0,i.eW)(" 上传习题图片 ")],-1)),(0,i.Lk)("div",f,[(0,i.Lk)("div",{class:"upload-area",onClick:m,onDragover:u[0]||(u[0]=(0,a.D$)((()=>{}),["prevent"])),onDrop:g},[(0,n.R1)(s).imageUrl?((0,i.uX)(),(0,i.CE)("div",I,[(0,i.Lk)("img",{src:(0,n.R1)(s).imageUrl,alt:"习题预览",class:"preview-image"},null,8,R),(0,i.Lk)("div",{class:"upload-new-prompt",onClick:(0,a.D$)(m,["stop"])},u[9]||(u[9]=[(0,i.Lk)("i",{class:"fas fa-plus-circle"},null,-1),(0,i.Lk)("span",null,"上传新习题图片",-1)])),(0,i.Lk)("button",{class:"zoom-button",onClick:(0,a.D$)(c,["stop"])},[(0,i.Lk)("i",{class:(0,l.C4)(["fas",o.value?"fa-search-minus":"fa-search-plus"])},null,2)])])):((0,i.uX)(),(0,i.CE)("div",L,[u[7]||(u[7]=(0,i.Lk)("div",{class:"upload-icon"},[(0,i.Lk)("i",{class:"fas fa-cloud-upload-alt"})],-1)),(0,i.Lk)("div",b,[u[5]||(u[5]=(0,i.Lk)("h3",null,"点击或拖拽上传图片",-1)),u[6]||(u[6]=(0,i.Lk)("p",null,"支持 JPG、PNG 格式，大小不超过 5MB",-1)),t.value?((0,i.uX)(),(0,i.CE)("div",w,u[4]||(u[4]=[(0,i.Lk)("i",{class:"fas fa-camera"},null,-1),(0,i.eW)(" 支持直接拍照上传 ")]))):(0,i.Q3)("",!0)]),u[8]||(u[8]=(0,i.Lk)("button",{class:"upload-btn"},"选择图片",-1))]))],32)]),(0,i.Lk)("div",C,[(0,i.Lk)("button",{class:"parse-btn",onClick:u[1]||(u[1]=e=>(0,n.R1)(s).parseImage()),disabled:!(0,n.R1)(s).imageUrl||(0,n.R1)(s).isProcessing},[u[10]||(u[10]=(0,i.Lk)("i",{class:"fas fa-cogs"},null,-1)),(0,i.eW)(" "+(0,l.v_)((0,n.R1)(s).isProcessing?"解析中...":"解析习题"),1)],8,S)]),(0,i.Lk)("input",{type:"file",id:"fileInput",accept:"image/*",capture:"camera",style:{display:"none"},onChange:y},null,32)]),o.value?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"image-overlay",onClick:u[3]||(u[3]=(0,a.D$)((e=>o.value=!1),["self"]))},[(0,i.Lk)("div",_,[(0,i.Lk)("img",{src:(0,n.R1)(s).imageUrl,alt:"放大预览",class:"original-size-image",style:(0,l.Tr)({transform:`scale(${r.value})`})},null,12,$),(0,i.Lk)("button",{class:"close-button",onClick:u[2]||(u[2]=e=>o.value=!1)},u[12]||(u[12]=[(0,i.Lk)("i",{class:"fas fa-times"},null,-1)])),(0,i.Lk)("div",M,[(0,i.Lk)("button",{onClick:p,disabled:r.value<=.5},u[13]||(u[13]=[(0,i.Lk)("i",{class:"fas fa-search-minus"},null,-1)]),8,x),(0,i.Lk)("span",null,(0,l.v_)(Math.round(100*r.value))+"%",1),(0,i.Lk)("button",{onClick:d,disabled:r.value>=3},u[14]||(u[14]=[(0,i.Lk)("i",{class:"fas fa-search-plus"},null,-1)]),8,K),(0,i.Lk)("button",{onClick:h},u[15]||(u[15]=[(0,i.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,i.eW)(" 重置 ")]))])])])):(0,i.Q3)("",!0)],64))}};const U=(0,v.A)(E,[["__scopeId","data-v-248900c7"]]);var A=U;const P={class:"action-section"},H={class:"result-section"},O={class:"result-content"},T={key:0,class:"loading"},X={key:0},J={key:1},j={key:0,class:"formula-status"},D=["innerHTML"];var F={__name:"ResultSection",setup(e){const t=u(),s=(0,n.KR)(null),a=(0,n.KR)(!1),o=(0,n.KR)(""),r=(0,n.KR)(""),c=(0,n.KR)("");(0,i.wB)((()=>t.isProcessing),((e,s)=>{s&&!e&&t.result&&h()}));const d=()=>{if(s.value)try{const e=document.createElement("textarea"),t=s.value.textContent||"";e.value=t,e.style.position="fixed",e.style.opacity=0,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),p()}catch(e){console.error("复制失败:",e),alert("复制失败，请手动选择内容复制")}},p=()=>{const e=document.querySelector(".copy-icon");e&&(e.classList.remove("fa-copy"),e.classList.add("fa-check"),e.style.color="#52c41a",setTimeout((()=>{e.classList.remove("fa-check"),e.classList.add("fa-copy"),e.style.color=""}),2e3))},h=()=>{if(t.result){try{t.addToHistory({id:Date.now(),imageUrl:t.imageUrl,result:t.result,formattedResult:t.formattedResult,timestamp:Date.now()}),a.value=!0,o.value="解析结果已自动保存到历史记录",r.value="save-success",c.value="fas fa-check-circle"}catch(e){console.error("保存失败:",e),a.value=!0,o.value="保存失败: "+(e.message||"未知错误"),r.value="save-error",c.value="fas fa-exclamation-circle"}setTimeout((()=>{a.value=!1}),3e3)}};return(e,a)=>((0,i.uX)(),(0,i.CE)("div",P,[(0,i.Lk)("div",H,[a[4]||(a[4]=(0,i.Lk)("h2",{class:"result-title"},[(0,i.Lk)("i",{class:"fas fa-file-alt"}),(0,i.eW)(" 解析结果")],-1)),(0,i.Lk)("div",O,[(0,n.R1)(t).isProcessing?((0,i.uX)(),(0,i.CE)("div",T,[a[0]||(a[0]=(0,i.Lk)("div",{class:"spinner"},null,-1)),a[1]||(a[1]=(0,i.Lk)("p",null,"正在使用AI解析习题中，请稍候...",-1)),(0,n.R1)(t).processingTime>0?((0,i.uX)(),(0,i.CE)("p",X,"剩余时间: "+(0,l.v_)((0,n.R1)(t).processingTime)+"秒",1)):(0,i.Q3)("",!0)])):(0,n.R1)(t).result?((0,i.uX)(),(0,i.CE)("div",J,[(0,n.R1)(t).formulaRendered?((0,i.uX)(),(0,i.CE)("div",j,[a[2]||(a[2]=(0,i.Lk)("i",{class:"fas fa-check-circle"},null,-1)),a[3]||(a[3]=(0,i.eW)(" 公式已渲染 ")),(0,i.Lk)("i",{class:"fas fa-copy copy-icon",onClick:d})])):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"exercise-results-container",id:"mathResult",innerHTML:(0,n.R1)(t).formattedResult,ref_key:"mathContainer",ref:s},null,8,D)])):(0,i.Q3)("",!0)])])]))}};const W=(0,v.A)(F,[["__scopeId","data-v-69bff64a"]]);var z=W;s(3579);const B={key:0,class:"loading-overlay"},Q={class:"modal-content"},N={class:"modal-header"},q={class:"modal-body"},V={class:"key-section"},G={class:"form-group"},Y={class:"form-label"},Z={class:"points-mini"},ee={class:"points-value"},te={class:"key-input-group"},se={class:"key-buttons"},ae={key:0,class:"history-section"},oe={key:0},ie={class:"buy-options"};var ne={__name:"KeyModal",setup(e){const t=u(),s=(0,n.KR)(""),o=(0,n.KR)(""),r=(0,n.KR)(!1),c=(0,n.KR)(!1),d=(0,n.KR)([]),p={100:"https://taobao.com/item1",200:"https://taobao.com/item2",500:"https://taobao.com/item3",1e3:"https://taobao.com/item4"};(0,i.sV)((async()=>{await t.loadKeyHistory(),d.value=t.redeemedKeys,t.userId||t.initUserId()}));const h=e=>e.length<8?"***":e.substring(0,4)+"***"+e.slice(-4),v=e=>new Date(e).toLocaleString(),m=()=>{},y=(e,t)=>{console.log(t),window.open(p[e],"_blank")},g=async()=>{if(s.value)if(t.redeemedKeys.some((e=>e.key===s.value)))k("该秘钥已被使用",!0);else{c.value=!0;try{console.log("88888888888888::"+s.value);const e=await t.validateKeyNew(s.value);console.log("99999999999999999999"),e.valid?(t.addPoints(e.points),k(`成功兑换 ${e.points} 积分!`,!1),s.value="",d.value=t.redeemedKeys):k(e.error||"无效的兑换码",!0)}catch(e){k(`兑换失败: ${e.message||"未知错误"}`,!0)}finally{c.value=!1}}else k("请输入兑换码",!0)},k=(e,t)=>{o.value=e,r.value=t,setTimeout((()=>{o.value=""}),3e3)},f=()=>{s.value&&navigator.clipboard.writeText(s.value).then((()=>{k("兑换码已复制",!1)})).catch((()=>{k("复制失败，请手动复制",!0)}))};return(e,u)=>((0,i.uX)(),(0,i.CE)(i.FK,null,[c.value?((0,i.uX)(),(0,i.CE)("div",B,u[6]||(u[6]=[(0,i.Lk)("div",{class:"spinner"},null,-1),(0,i.Lk)("p",null,"正在验证秘钥...",-1)]))):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:(0,l.C4)(["modal",{active:(0,n.R1)(t).showKeyModal}])},[(0,i.Lk)("div",Q,[(0,i.Lk)("div",N,[u[7]||(u[7]=(0,i.Lk)("div",null,[(0,i.Lk)("h3",{class:"modal-title"},"积分秘钥管理")],-1)),(0,i.Lk)("button",{class:"close-modal",onClick:u[0]||(u[0]=e=>(0,n.R1)(t).showKeyModal=!1)},"×")]),(0,i.Lk)("div",q,[(0,i.Lk)("div",V,[(0,i.Lk)("div",G,[(0,i.Lk)("div",Y,[u[10]||(u[10]=(0,i.Lk)("div",{class:"form-des"},"积分秘钥",-1)),(0,i.Lk)("div",Z,[u[8]||(u[8]=(0,i.Lk)("i",{class:"fas fa-coins"},null,-1)),(0,i.Lk)("span",ee,(0,l.v_)((0,n.R1)(t).points),1),u[9]||(u[9]=(0,i.Lk)("span",null,"积分",-1))])]),(0,i.Lk)("div",te,[(0,i.bo)((0,i.Lk)("input",{type:"text",class:"key-input",placeholder:"请输入积分秘钥","onUpdate:modelValue":u[1]||(u[1]=e=>s.value=e),onInput:m},null,544),[[a.Jo,s.value]]),(0,i.Lk)("div",se,[(0,i.Lk)("button",{class:"key-button",onClick:f},u[11]||(u[11]=[(0,i.Lk)("i",{class:"fas fa-copy"},null,-1)])),(0,i.Lk)("button",{class:(0,l.C4)(["redeem-btn",{show:s.value}]),onClick:g},u[12]||(u[12]=[(0,i.Lk)("i",{class:"fas fa-gift"},null,-1),(0,i.eW)(" 兑换 ")]),2)])]),o.value?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,l.C4)(["redeem-message",{error:r.value}])},(0,l.v_)(o.value),3)):(0,i.Q3)("",!0)])]),d.value.length?((0,i.uX)(),(0,i.CE)("div",ae,[u[13]||(u[13]=(0,i.Lk)("h3",null,"兑换历史",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(d.value,((e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t},[(0,i.eW)((0,l.v_)(v(e.date))+" - 兑换 "+(0,l.v_)(e.points)+" 积分 ",1),e.key?((0,i.uX)(),(0,i.CE)("span",oe,"(秘钥: "+(0,l.v_)(h(e.key))+")",1)):(0,i.Q3)("",!0)])))),128))])])):(0,i.Q3)("",!0),u[18]||(u[18]=(0,i.Lk)("div",{class:"purchase-guide"},[(0,i.Lk)("i",{class:"fas fa-lightbulb"}),(0,i.Lk)("span",null,"点击购买以下积分套餐，获取更多积分")],-1)),(0,i.Lk)("div",ie,[(0,i.Lk)("div",{class:"buy-option",onClick:u[2]||(u[2]=e=>y(100,10))},u[14]||(u[14]=[(0,i.Lk)("div",{class:"option-icon"},[(0,i.Lk)("i",{class:"fas fa-gem"})],-1),(0,i.Lk)("h3",null,"100积分",-1),(0,i.Lk)("p",null,"¥10",-1),(0,i.Lk)("div",{class:"option-hint"},"基础套餐",-1)])),(0,i.Lk)("div",{class:"buy-option",onClick:u[3]||(u[3]=e=>y(200,18))},u[15]||(u[15]=[(0,i.Lk)("div",{class:"option-icon"},[(0,i.Lk)("i",{class:"fas fa-crown"})],-1),(0,i.Lk)("h3",null,"200积分",-1),(0,i.Lk)("p",null,[(0,i.eW)("¥18 "),(0,i.Lk)("span",{class:"discount"},"(9折)")],-1),(0,i.Lk)("div",{class:"option-hint"},"热门选择",-1)])),(0,i.Lk)("div",{class:"buy-option",onClick:u[4]||(u[4]=e=>y(500,40))},u[16]||(u[16]=[(0,i.Lk)("div",{class:"option-icon"},[(0,i.Lk)("i",{class:"fas fa-rocket"})],-1),(0,i.Lk)("h3",null,"500积分",-1),(0,i.Lk)("p",null,[(0,i.eW)("¥40 "),(0,i.Lk)("span",{class:"discount"},"(8折)")],-1),(0,i.Lk)("div",{class:"option-hint"},"超值推荐",-1)])),(0,i.Lk)("div",{class:"buy-option",onClick:u[5]||(u[5]=e=>y(1e3,75))},u[17]||(u[17]=[(0,i.Lk)("div",{class:"option-icon"},[(0,i.Lk)("i",{class:"fas fa-diamond"})],-1),(0,i.Lk)("h3",null,"1000积分",-1),(0,i.Lk)("p",null,[(0,i.eW)("¥75 "),(0,i.Lk)("span",{class:"discount"},"(7.5折)")],-1),(0,i.Lk)("div",{class:"option-hint"},"尊享套餐",-1)]))])])])],2)],64))}};const le=(0,v.A)(ne,[["__scopeId","data-v-0062b3ee"]]);var re=le;const ce={class:"modal-content"},de={class:"modal-header"},ue={class:"modal-footer"};var pe={__name:"ServiceModal",setup(e){const t=u();return(e,s)=>((0,i.uX)(),(0,i.CE)("div",{class:(0,l.C4)(["modal",{active:(0,n.R1)(t).showServiceModal}])},[(0,i.Lk)("div",ce,[(0,i.Lk)("div",de,[s[3]||(s[3]=(0,i.Lk)("h3",{class:"modal-title"},"联系客服",-1)),(0,i.Lk)("button",{class:"close-modal",onClick:s[0]||(s[0]=e=>(0,n.R1)(t).showServiceModal=!1)},"×")]),s[5]||(s[5]=(0,i.Lk)("div",{class:"modal-body"},[(0,i.Lk)("div",{class:"key-note",style:{"text-align":"center"}},[(0,i.Lk)("p",null,[(0,i.Lk)("i",{class:"fas fa-comments",style:{"font-size":"3rem",color:"#38bdf8","margin-bottom":"15px"}})]),(0,i.Lk)("p",null,"客服工作时间：9:00-18:00（工作日）"),(0,i.Lk)("p",null,"紧急问题：400-123-4567"),(0,i.Lk)("p",null,"微信客服：MathSolver_Service"),(0,i.Lk)("p",null,"QQ客服：123456789"),(0,i.Lk)("p",null,"邮箱：support@mathsolver.com")])],-1)),(0,i.Lk)("div",ue,[(0,i.Lk)("button",{class:"confirm-btn service-btn-modal",onClick:s[1]||(s[1]=(...e)=>(0,n.R1)(t).copyWechat&&(0,n.R1)(t).copyWechat(...e))},s[4]||(s[4]=[(0,i.Lk)("i",{class:"fab fa-weixin"},null,-1),(0,i.eW)(" 复制微信客服 ")])),(0,i.Lk)("button",{class:"confirm-btn",onClick:s[2]||(s[2]=e=>(0,n.R1)(t).showServiceModal=!1)}," 关闭 ")])])],2))}};const he=(0,v.A)(pe,[["__scopeId","data-v-db687e08"]]);var ve=he;const me={class:"modal-content"},ye={class:"modal-header"},ge={class:"modal-body"},ke={class:"modal-footer"};var fe={__name:"InsufficientModal",setup(e){const t=u();return(e,s)=>((0,i.uX)(),(0,i.CE)("div",{class:(0,l.C4)(["modal",{active:(0,n.R1)(t).showInsufficientModal}])},[(0,i.Lk)("div",me,[(0,i.Lk)("div",ye,[s[2]||(s[2]=(0,i.Lk)("h3",{class:"modal-title"},"积分不足",-1)),(0,i.Lk)("button",{class:"close-modal",onClick:s[0]||(s[0]=e=>(0,n.R1)(t).showInsufficientModal=!1)},"×")]),(0,i.Lk)("div",ge,[s[4]||(s[4]=(0,i.Lk)("p",null,"您的积分不足，无法进行解析操作。",-1)),(0,i.Lk)("p",null,[s[3]||(s[3]=(0,i.eW)("当前积分: ")),(0,i.Lk)("strong",null,(0,l.v_)((0,n.R1)(t).points),1),(0,i.eW)("，解析需要"+(0,l.v_)((0,n.R1)(t).parseCost)+"积分。",1)]),s[5]||(s[5]=(0,i.Lk)("p",null,"请购买积分后继续使用。",-1))]),(0,i.Lk)("div",ke,[(0,i.Lk)("button",{class:"confirm-btn",onClick:s[1]||(s[1]=e=>{(0,n.R1)(t).showInsufficientModal=!1,(0,n.R1)(t).showKeyModal=!0})},"购买积分")])])],2))}};const Le=fe;var be=Le;const we={class:"sidebar-header"},Ie={class:"history-list"},Re={key:0,class:"loading-history"},Ce={key:1,class:"empty-history"},Se=["onClick"],_e={class:"item-thumbnail"},$e=["src"],Me={class:"item-info"},xe={class:"item-title"},Ke={class:"item-time"},Ee={class:"item-preview"},Ue=["onClick"];var Ae={__name:"HistorySidebar",setup(e){const t=u(),s=(0,n.KR)(!1);(0,i.sV)((()=>{0===t.history.length&&o()}));const o=()=>{s.value=!0;try{const e=localStorage.getItem("mathSolverHistory");e&&(t.history=JSON.parse(e))}catch(e){console.error("加载历史记录失败:",e)}finally{s.value=!1}},r=e=>{const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},c=e=>{if(console.log("what-1?"),null==e)return"";console.log("what0?"),console.log(e),console.log("what111");try{var t=e.output;t.length>0&&(e=t[0].question),console.log("waht22"),console.log(e)}catch(a){console.log(a)}if("string"!==typeof e)try{e=String(e)}catch{return""}const s=e.replace(/<[^>]*>/g,"");return s.length>30?s.substring(0,30)+"...":s},d=e=>{t.loadHistory(e),t.showHistorySidebar=!1},p=e=>{t.removeHistory(e)};return(e,o)=>((0,i.uX)(),(0,i.CE)("div",{class:(0,l.C4)(["history-sidebar",{active:(0,n.R1)(t).showHistorySidebar}])},[(0,i.Lk)("div",we,[o[2]||(o[2]=(0,i.Lk)("h3",null,[(0,i.Lk)("i",{class:"fas fa-history"}),(0,i.eW)(" 历史记录")],-1)),(0,i.Lk)("button",{class:"close-btn",onClick:o[0]||(o[0]=e=>(0,n.R1)(t).showHistorySidebar=!1)},o[1]||(o[1]=[(0,i.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,i.Lk)("div",Ie,[s.value?((0,i.uX)(),(0,i.CE)("div",Re,o[3]||(o[3]=[(0,i.Lk)("div",{class:"spinner"},null,-1),(0,i.Lk)("p",null,"加载历史记录中...",-1)]))):0===(0,n.R1)(t).history.length?((0,i.uX)(),(0,i.CE)("div",Ce,o[4]||(o[4]=[(0,i.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,i.Lk)("p",null,"暂无历史记录",-1),(0,i.Lk)("p",null,"解析后的习题将保存在这里",-1)]))):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:2},(0,i.pI)((0,n.R1)(t).history,((e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:s,class:(0,l.C4)(["history-item",{active:(0,n.R1)(t).activeHistory===e.id}]),onClick:t=>d(e)},[(0,i.Lk)("div",_e,[(0,i.Lk)("img",{src:e.imageUrl,alt:"历史习题"},null,8,$e)]),(0,i.Lk)("div",Me,[(0,i.Lk)("div",xe,"解析记录 #"+(0,l.v_)(s+1),1),(0,i.Lk)("div",Ke,(0,l.v_)(r(e.timestamp)),1),(0,i.Lk)("div",Ee,(0,l.v_)(c(e.result)),1)]),(0,i.Lk)("button",{class:"delete-btn",onClick:(0,a.D$)((t=>p(e.id)),["stop"])},o[5]||(o[5]=[(0,i.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,Ue)],10,Se)))),128))])],2))}};const Pe=(0,v.A)(Ae,[["__scopeId","data-v-4249156e"]]);var He=Pe;const Oe={class:"container"},Te={class:"app-card"},Xe={class:"control-corner"},Je={key:0,class:"history-badge"},je={class:"main-content"};var De={__name:"App",setup(e){const t=u();return(0,i.sV)((()=>{t.userId||t.initUserId()})),(e,s)=>((0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",Oe,[(0,i.Lk)("div",Te,[(0,i.Lk)("div",Xe,[(0,i.Lk)("div",{class:"history-btn",onClick:s[0]||(s[0]=e=>(0,n.R1)(t).showHistorySidebar=!0),title:"历史记录"},[s[1]||(s[1]=(0,i.Lk)("i",{class:"fas fa-history"},null,-1)),(0,n.R1)(t).history.length>0?((0,i.uX)(),(0,i.CE)("span",Je,(0,l.v_)((0,n.R1)(t).history.length),1)):(0,i.Q3)("",!0)])]),(0,i.bF)(g),(0,i.Lk)("div",je,[(0,i.bF)(A),(0,i.bF)(z)])])]),(0,n.R1)(t).showKeyModal?((0,i.uX)(),(0,i.Wv)(re,{key:0})):(0,i.Q3)("",!0),(0,n.R1)(t).showServiceModal?((0,i.uX)(),(0,i.Wv)(ve,{key:1})):(0,i.Q3)("",!0),(0,n.R1)(t).showInsufficientModal?((0,i.uX)(),(0,i.Wv)(be,{key:2})):(0,i.Q3)("",!0),(0,n.R1)(t).showHistorySidebar?((0,i.uX)(),(0,i.Wv)(He,{key:3})):(0,i.Q3)("",!0)],64))}};const Fe=(0,v.A)(De,[["__scopeId","data-v-94844036"]]);var We=Fe;const ze=(0,a.Ef)(We);ze.use((0,o.Ey)()),ze.mount("#app")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,a,o,i){if(!a){var n=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],i=e[d][2];for(var l=!0,r=0;r<a.length;r++)(!1&i||n>=i)&&Object.keys(s.O).every((function(e){return s.O[e](a[r])}))?a.splice(r--,1):(l=!1,i<n&&(n=i));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[a,o,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,n=a[0],l=a[1],r=a[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(o in l)s.o(l,o)&&(s.m[o]=l[o]);if(r)var d=r(s)}for(t&&t(a);c<n.length;c++)i=n[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},a=self["webpackChunkinsect2"]=self["webpackChunkinsect2"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(1834)}));a=s.O(a)})();
//# sourceMappingURL=app.1252d683.js.map